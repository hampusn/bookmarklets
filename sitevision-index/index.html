<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitevision index</title>
    <meta name="description" content="Search in the indexes and view the indexed data.">
    <link rel="stylesheet" href="/assets/css/main.css?v=0.12.1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  </head>
  <body class="template-bookmarklet ">
    <div class="page is-flex is-flex-direction-column">
      <header class="page-header">
        <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
          <div class="navbar-brand">
            <a class="home-item navbar-item" href="/">
              <svg class="home-item__icon icon" aria-hidden="true"><use href="/assets/img/icons.svg?v=0.12.1#mdi-bookmark-multiple"></use></svg>
              <span class="home-item__text is-family-secondary pr-4">Bookmarklets</span>
            </a>

            <button type="button" class="navbar-burger" aria-label="Menu" aria-expanded="false" data-target="menu">
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </button>
          </div>

          <div id="menu" class="navbar-menu">
            <div class="navbar-end">
              <div class="navbar-item">
                <div class="buttons">
                  <a class="button is-secondary" href="https://github.com/hampusn/bookmarklets#readme">
                    <svg class="icon" aria-hidden="true"><use href="/assets/img/icons.svg?v=0.12.1#mdi-github"></use></svg>
                    <strong>Github</strong>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header><!--! .page-header -->

      <main class="page-main is-flex-grow-1 ">
        

        <div class="section">
  <div class="container is-max-desktop">
    <div class="content">
      <h1 class="is-family-secondary">Sitevision index</h1><p>This bookmarklet opens a modal with a search form, allowing you to query the available indexes on a Sitevision website. Results are displayed in a table, where each row represents a search hit. Clicking a row reveals all the indexed data for that specific entry.</p>
<p>Perfect for exploring and debugging indexed content on Sitevision websites.</p>
<div class="overlap-images">
  <img src="/sitevision-index/sitevision-index-1.png" alt="Screenshot with the bookmarklet's modal in view." />
  <img src="/sitevision-index/sitevision-index-2.png" alt="Screenshot with indexed data for a search hit." />
</div>

    </div>
  </div>
</div>

<div class="section has-background-light">
  <div class="container is-max-desktop">
    <dl class="block is-flex-desktop is-flex-wrap-wrap is-justify-content-center">
      <div class="is-flex mx-3 my-1">
        <dt class="has-text-weight-semibold mr-2">Created</dt>
        <dd>2025-01-08</dd>
      </div>

      

      <div class="is-flex mx-3 my-1">
        <dt class="has-text-weight-semibold mr-2">Bookmarklet size</dt>
        <dd>17.1 kB</dd>
      </div>
    </dl>

    <div class="has-text-centered-desktop my-6">
      <p class="is-size-5 mb-2">Drag this link to your bookmarks to save it.</p>
      <a class="bookmarklet-button button is-link is-medium" href="javascript:!function()%7B%22use%20strict%22%3Bconst%20e%3Dwindow.document%3Bfunction%20t(t)%7Bconst%20i%3De.createElement(%22template%22)%3Breturn%20i.innerHTML%3Dt%2Ci.content.firstElementChild%7Dconst%20i%3D%22click%22%2Cn%3D(e%2Ct%2Ci)%3D%3Ee.addEventListener(t%2Ci)%3Bvar%20s%3D(e%2Ct)%3D%3En(e%2Ci%2Ct)%2Co%3D(e%2Ct)%3D%3En(e%2C%22keydown%22%2Ct)%2Cl%3D(e%2Ct)%3D%3En(e%2C%22submit%22%2Ct)%3Bconst%20a%3D%22env-modal-dialog%22%2Cr%3D%22env-spinner-bounce%22%2Cd%3Dwindow.document%2Ch%3Dwindow.envision%3Bclass%20c%7Bconstructor(%7BdialogId%3Ae%2Ctitle%3At%2Csize%3Ai%2CcloseText%3An%3D%22Close%22%7D)%7Bthis.id%3De%2Cthis.isLoading%3D!1%2Cthis.isDisabled%3D!1%2Cthis.title%3Dt%2Cthis.size%3Di%2Cthis.closeText%3Dn%2Cthis.context%3D%7B%7D%2Cthis.tid%3De%2B%22-t%22%2Cthis.thid%3De%2B%22-th%22%2Cthis.cid%3De%2B%22-c%22%2Cthis.eid%3De%2B%22-e%22%2Cthis.fid%3De%2B%22-f%22%2Cthis.lid%3De%2B%22-l%22%7Del(e)%7Breturn%20d.getElementById(e)%7Dasync%20init(e)%7Bconst%20t%3Dthis.id%2Ci%3Dthis.tid%3Bif(this.el(t))return%20this%3Blet%20n%3Btry%7Be%3D%22function%22%3D%3Dtypeof%20e%3Fawait%20e.call(null%2Cthis)%3Ae%7Dcatch(e)%7Bn%3De%7Dconst%20o%3D%22string%22%3D%3Dtypeof%20e%3Fe%3A%22%22%2Cl%3Dthis.size%3F%60%24%7Ba%7D__dialog--%24%7Bthis.size%7D%60%3A%22%22%3Breturn%20d.body.insertAdjacentHTML(%22beforeend%22%2C%60%3Cdiv%20id%3D%22%24%7Bt%7D%22%20class%3D%22%24%7Ba%7D%20%24%7Ba%7D--inner-scroll%22%20style%3D%22z-index%3A99999%22%20role%3D%22dialog%22%20aria-modal%3D%22true%22%20aria-labelledby%3D%22%24%7Bi%7D%22%20aria-hidden%3D%22true%22%20tabindex%3D%22-1%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class%3D%22%24%7Ba%7D__dialog%20%24%7Bl%7D%22%3E%5Cn%20%20%20%20%20%20%20%20%3Csection%20class%3D%22%24%7Ba%7D__content%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cheader%20class%3D%22%24%7Ba%7D__header%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Ch5%20id%3D%22%24%7Bi%7D%22%20class%3D%22env-text%20env-d--flex%20env-flex--align-items-center%20env-flex--justify-content-between%20%24%7Ba%7D__header__title%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20id%3D%22%24%7Bthis.thid%7D%22%3E%24%7Bthis.title%7D%3C%2Fspan%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22%24%7Bthis.lid%7D%22%20class%3D%22%24%7Br%7D%20%24%7Br%7D--hide%20%24%7Br%7D--fade-in%22%20data-delay%3D%22medium%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24%7B%5B1%2C2%2C3%5D.map((e%3D%3E%60%3Cdiv%20class%3D%22env-bounce%24%7Be%7D%22%3E%3C%2Fdiv%3E%60)).join(%22%22)%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fh5%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C%2Fheader%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22%24%7Ba%7D__body%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22%24%7Bthis.cid%7D%22%3E%24%7Bo%7D%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22%24%7Bthis.eid%7D%22%20class%3D%22env-alert%20env-alert--danger%22%20hidden%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20data-error-holder%3E%3C%2Fspan%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20type%3D%22button%22%20class%3D%22env-alert__close%20env-button%20env-button--link%20env-button--icon%20env-button--icon-small%22%20data-dismiss%3D%22alert%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Close%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Csvg%20class%3D%22env-icon%20env-icon--xx-small%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cuse%20href%3D%22%2Fsitevision%2Fenvision-icons.svg%23icon-delete%22%3E%3C%2Fuse%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fsvg%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fbutton%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cfooter%20id%3D%22%24%7Bthis.fid%7D%22%20class%3D%22%24%7Ba%7D__footer%20env-d--flex%20env-flex--justify-content-between%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20type%3D%22button%22%20data-modal-dialog-dismiss%20class%3D%22env-button%20env-m-left--a%22%3E%24%7Bthis.closeText%7D%3C%2Fbutton%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C%2Ffooter%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fsection%3E%5Cn%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%3C%2Fdiv%3E%60)%2Cn%26%26this.renderError(n)%2Cs(this.el(this.eid).querySelector(&#39;%5Bdata-dismiss%3D%22alert%22%5D&#39;)%2C(()%3D%3E%7Bthis.renderError(%22%22)%7D))%2Ce%20instanceof%20HTMLElement%26%26this.el(this.cid).appendChild(e)%2Cthis%7DisOpen()%7Breturn%20this.el(this.id)%3F.classList.contains(%22env-modal-dialog--show%22)%7DupdateTitle(e)%7Bthis.title%3De%2Cthis.el(this.thid).innerHTML%3De%7DupdateContent(e)%7Bthis.el(this.cid).innerHTML%3De%7DsetLoading(e)%7Bthis.isLoading%3D!!e%2Cthis.el(this.lid).classList.toggle(%60%24%7Br%7D--hide%60%2C!this.isLoading)%7DsetDisabled(e)%7Bthis.isDisabled%3D!!e%2Cthis.el(this.id).inert%3Dthis.isDisabled%2Cthis.el(this.cid).style.opacity%3Dthis.isDisabled%3F.5%3A1%2Cthis.el(this.fid).querySelectorAll(%22.env-button%22).forEach((e%3D%3Ee.disabled%3Dthis.isDisabled))%7DrenderError(e)%7Bconst%20t%3D!!e%2Ci%3Dthis.el(this.eid)%3Bi.querySelector(%22%5Bdata-error-holder%5D%22).innerHTML%3De%2Ci.hidden%3D!t%2Cthis.el(this.cid).hidden%3Dt%7DonClose(e)%7Breturn%22function%22%3D%3Dtypeof%20e%26%26jQuery(%22%23%22%2Bthis.id).on(%22hide.env-modal-dialog%22%2C(t%3D%3E%7Be.call(null%2Cthis%2Ct)%7D))%2Cthis%7DonClosed(e)%7Breturn%22function%22%3D%3Dtypeof%20e%26%26jQuery(%22%23%22%2Bthis.id).on(%22hidden.env-modal-dialog%22%2C(t%3D%3E%7Be.call(null%2Cthis%2Ct)%7D))%2Cthis%7Dhide(e)%7Breturn%20h.dialog(%22%23%22%2Bthis.id%2C%22hide%22).then(e%3Fe.bind(null%2Cthis)%3Anull)%2Cthis%7Dtoggle(e)%7Breturn%20h.dialog(%22%23%22%2Bthis.id%2C%22toggle%22).then(e%3Fe.bind(null%2Cthis)%3Anull)%2Cthis%7Dremove()%7Bthis.el(this.id).remove()%7D%7Dconst%20u%3D(e%3Dnull)%3D%3E%7Bconst%20t%3Dwindow.__BookmarkletDialogInstances%3Dwindow.__BookmarkletDialogInstances%7C%7C%7B%7D%3Breturn%20e%3Ft%5Be%5D%3At%7D%2Cv%3D(e%2Ct%3D%7B%7D)%3D%3E%7Bconst%20i%3Du()%3Breturn%20i%5Be%5D%7C%7C(i%5Be%5D%3Dnew%20c(%7B...t%2CdialogId%3Ae%7D))%2Ci%5Be%5D%7D%2Cp%3Dwindow.document%3Bconst%20m%3D%7Bheight%3A300%2Ccaption%3A%22%22%7D%3Bclass%20b%7Bconstructor(e%2Ct%2Ci%3D%7B%7D)%7Bthis.headers%3De%2Cthis.data%3Dt%2Cthis.dataFormat%3Dnull%2Cthis.rowHeight%3D27.5%2Cthis.cols%3D%5B%5D%2Cthis.el%3Dnull%2Cthis.bodyEl%3Dnull%2Cthis.pool%3D%5B%5D%2Cthis.opts%3D%7B...m%2C...i%7D%2Cthis.start%3D0%2Cthis.init()%7Dinit()%7Bconst%20e%3DObject.values(this.headers)%2Ci%3Dthis.opts%2Cn%3Di.caption%2Cs%3Di.height%3B!function(e%2Ct)%7Blet%20i%3Ddocument.getElementById(e)%3Bi%7C%7C(p.head.insertAdjacentHTML(%22beforeend%22%2C%60%3Cstyle%20id%3D%22%24%7Be%7D%22%3E%24%7Bt%7D%3C%2Fstyle%3E%60)%2Ci%3Ddocument.getElementById(e))%7D(%22__VTable-styles%22%2C%22.__VTable-container%7Boverflow-y%3Aauto%7D.__VTable-container%20table%7Btable-layout%3Afixed%7D.__VTable-container%20thead%7Bposition%3Asticky%3Btop%3A0%3Bz-index%3A2%7D.__VTable-container%20thead%20tr%7Bbackground%3Avar(--env-section-background-color)%7D.__VTable-container%20tbody%20td%2C.__VTable-container%20thead%20th%7Bbox-sizing%3Aborder-box%3Bflex%3A1%3Boverflow%3Ahidden%3Btext-align%3Aleft%3Btext-overflow%3Aellipsis%3Bwhite-space%3Anowrap%7D.__VTable-container%20tbody%20td%3Afirst-child%2C.__VTable-container%20thead%20th%3Afirst-child%7Bflex%3Ainitial%3Bwidth%3A6em%7D.__VTable-container%20tbody%7Bposition%3Arelative%7D.__VTable-container%20tbody%20tr%7Bdisplay%3Aflex%3Bposition%3Aabsolute%3Bwidth%3A100%25%7D.__VTable-container%20.env-table--hover%20tr%3Ahover%7Bcursor%3Apointer%7D%22)%2Cthis.cols%3DObject.keys(this.headers)%2Cthis.el%3Dt(%60%3Cdiv%20class%3D%22__VTable-container%22%20style%3D%22height%3A%24%7Bs%7Dpx%3B%22%3E%5Cn%20%20%20%20%20%20%20%20%3Ctable%20class%3D%22env-table%20env-table--small%20env-table--hover%20env-w--100%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%24%7Bn%3F%60%3Ccaption%20class%3D%22env-assistive-text%22%3E%24%7Bn%7D%3C%2Fcaption%3E%60%3A%22%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%3Cthead%20class%3D%22env-d--block%20env-w--100%22%3E%3Ctr%20class%3D%22env-d--flex%22%3E%24%7Be.map(((e%2Ct)%3D%3E%60%3Cth%3E%24%7Be%7D%3C%2Fth%3E%60)).join(%22%22)%7D%3C%2Ftr%3E%3C%2Fthead%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Ctbody%20class%3D%22env-d--block%22%20style%3D%22height%3A%24%7Bs%7Dpx%3B%22%3E%3C%2Ftbody%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Ftable%3E%5Cn%20%20%20%20%20%20%3C%2Fdiv%3E%60)%2Cthis.bodyEl%3Dthis.el.querySelector(%22tbody%22)%7DsetData(e)%7Bthis.data%3DArray.isArray(e)%3Fe.map(((e%2Ct)%3D%3E(e.%24index%3Dt%2B1%2Ce)))%3A%5B%5D%2Cthis.numRows%3Dthis.data.length%7DgetRowData(e)%7Breturn%20this.data%5Be%5D%7DrenderRows(e%2Ct%3D!1)%7Bconst%20i%3DMath.floor(e%2Fthis.rowHeight)%3Bif(t%7C%7Cthis.start!%3D%3Di)%7Bthis.start%3Di%3Bfor(let%20e%3D0%3Be%3Cthis.pool.length%3Be%2B%2B)%7Bconst%20t%3Dthis.start%2Be%3Bif(t%3Cthis.numRows)%7Bconst%20i%3Dthis.pool%5Be%5D%2Cn%3Di.children%3Bfor(const%5Be%2Ci%5Dof%20this.cols.entries())n%5Be%5D.textContent%3Dthis.data%5Bt%5D%5Bi%5D%3Bi.dataset.rowIndex%3Dt%2Ci.style.transform%3D%60translateY(%24%7Bt*this.rowHeight%7Dpx)%60%2Ci.style.display%3D%22%22%7Delse%20this.pool%5Be%5D.style.display%3D%22none%22%7D%7D%7DcomputeRowHeight()%7Bconst%20e%3Dt(%22%3Ctr%3E%3Ctd%3E%26nbsp%3B%3C%2Ftd%3E%3C%2Ftr%3E%22)%3Breturn%20this.bodyEl.appendChild(e)%2Cthis.rowHeight%3De.getBoundingClientRect().height%2Cthis.bodyEl.removeChild(e)%2Cthis.rowHeight%7DcomputeVisibleRows()%7Breturn%20Math.max(Math.ceil(this.el.clientHeight%2Fthis.rowHeight)%2B2%2C10)%7DresetPool()%7Bconst%20e%3Dthis.computeVisibleRows()%3Bthis.pool%3D%5B%5D%2Cthis.bodyEl.innerHTML%3D%22%22%3Bfor(let%20i%3D0%3Bi%3Ce%3Bi%2B%2B)%7Bconst%20e%3Dt(%60%3Ctr%3E%24%7B%22%3Ctd%3E%3C%2Ftd%3E%22.repeat(this.cols.length)%7D%3C%2Ftr%3E%60)%3Bthis.pool.push(e)%2Cthis.bodyEl.appendChild(e)%7D%7DcomputeTableDimensions()%7Bthis.computeRowHeight()%2Cthis.computeVisibleRows()%2Cthis.resetPool()%2Cthis.bodyEl.style.height%3Dthis.numRows*this.rowHeight%2B%22px%22%7DrenderTo(e)%7Be.appendChild(this.el)%2Cthis.el.addEventListener(%22scroll%22%2C(()%3D%3E%7Bthis.renderRows(this.el.scrollTop)%7D))%2Cthis.renderRows(0%2C!0)%7DonRowClick(e)%7B%22function%22%3D%3Dtypeof%20e%26%26this.bodyEl.addEventListener(%22click%22%2C(t%3D%3E%7Bconst%20i%3Dt.target%2Cn%3DparseInt((%22TR%22%3D%3D%3Di%3F.tagName%3Fi%3Ai.closest(%22tr%22))%3F.dataset.rowIndex%2C10)%3Bif(Number.isInteger(n))%7Bconst%20t%3Dthis.getRowData(n)%3Be.call(null%2Ct%2Cn)%7D%7D))%7Dupdate(e)%7Bthis.setData(e)%2Cthis.bodyEl.style.height%3Dthis.numRows*this.rowHeight%2B%22px%22%2Cthis.el.scrollTop%3D0%2Cthis.renderRows(0%2C!0)%7D%7Dfunction%20y()%7Breturn%22-%22%2BMath.random().toString(36).slice(2%2C11)%7Dconst%20f%3D0%2Cg%3D1%3Basync%20function%20w(%7BnodeId%3Ae%2Cpath%3At%2CsiteName%3Ai%2Cversion%3An%3Dg%2CapiMethod%3As%3D%22nodes%22%2Coptions%3Ao%3D%7B%7D%2Corigin%3Al%3Dwindow.location.origin%2CreturnError%3Aa%3D!1%7D)%7Bif(!(e%7C%7Ct%26%26i))throw%22Api%20needs%20either%20a%20nodeId%20or%20a%20path.%22%3Bconst%20r%3DencodeURIComponent(JSON.stringify(o))%2Cd%3D%7Bheaders%3A%7B%22Content-Type%22%3A%22application%2Fjson%22%2CAccept%3A%22application%2Fjson%22%7D%7D%2Ch%3D%5Bf%2Cg%5D.includes(n)%3Fn%3Ag%2Cc%3D%60%24%7Bl%7D%2Frest-api%2F1%2F%24%7Bh%7D%2F%24%7Be%7C%7Ci%2B%22%2F%22%2Bt.replace(%2F%5E%5C%2F%7C%5C%2F%24%2F%2C%22%22)%7D%2F%24%7Bs%7D%3Fformat%3Djson%26json%3D%24%7Br%7D%60%3Blet%20u%3Bh%3D%3D%3Df%26%26(d.credentials%3D%22same-origin%22)%3Blet%20v%3D%7B%7D%3Btry%7Bu%3Dawait%20fetch(c%2Cd)%2Cv%3Dawait%20u.json()%7Dcatch(p)%7Bu%3D%7Bok%3A!1%2Cstatus%3Au.status%7D%2Cv%3D%7Bmessage%3AString(p)%7D%7Dlet%20p%3Dnull%3Bif(!u.ok%26%26(p%3D%5B%60Status%20%24%7Bu.status%7D%60%2Cv%3F.description%2Cv%3F.message%5D.filter((e%3D%3E!!e)).join(%22%2C%20%22)%2C!a))throw%20p%3Breturn%20a%3F%5Bv%2Cp%5D%3Av%7Dconst%20%24%3Dwindow.document%3Bvar%20_%3Dfunction(e)%7B%24.dispatchEvent(new%20CustomEvent(%22sv-publish-toast%22%2C%7Bdetail%3A%7Btype%3A%22%22%2C...e%7D%7D))%7D%3B(async(e%2Ci)%3D%3E%7Bif(!e.envision)return%20void%20console.warn(%22Envision%20not%20found.%20Exiting%20since%20most%20likely%20not%20Sitevision.%22)%3Bconst%20n%3D%22sitevision-index-dialog%22%2Cs%3D%60%24%7Bn%7D_row%60%3Blet%20a%3Bif(!i.getElementById(n))try%7Ba%3Dawait%20w(%7BnodeId%3A%60%24%7Be.sv.PageContext.siteId%7D_indexRepository%60%7D)%7Dcatch(e)%7Breturn%20void%20_(%7Bmessage%3AString(e)%7D)%7Dconst%20r%3Dv(n%2C%7Btitle%3A%22Sitevision%20index%22%2Csize%3A%22large%22%7D)%3Blet%20d%3Du(s)%3Bawait%20r.init((async%20e%3D%3E%7Bconst%20i%3Dt(%22%3Cdiv%3E%3C%2Fdiv%3E%22)%2Cs%3Dy()%2Cr%3Dy()%2Ch%3Dt(%60%3Cform%20class%3D%22env-form%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22env-form__row%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22env-form-element%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20for%3D%22%24%7Br%7D%22%20class%3D%22env-form-element__label%22%3EIndex%3C%2Flabel%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22env-form-element__control%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cselect%20class%3D%22env-form-input%22%20id%3D%22%24%7Br%7D%22%20name%3D%22index%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24%7Ba.map((e%3D%3E%60%3Coption%20value%3D%22%24%7Be.id%7D%22%3E%24%7Be.name%7D%3C%2Foption%3E%60)).join(%22%22)%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fselect%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22env-form-element%20env-form-element--2%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20for%3D%22%24%7Bs%7D%22%20class%3D%22env-form-element__label%22%3ESearch%20query%3C%2Flabel%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22env-form-element__control%20env-form-input-group%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20id%3D%22%24%7Bs%7D%22%20type%3D%22search%22%20name%3D%22query%22%20class%3D%22env-form-input%20env-form-input--search%20env-flex__item--length-1%22%20placeholder%3D%22%22%20%2F%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20type%3D%22submit%22%20class%3D%22env-button%20env-button--primary%22%3ESearch%3C%2Fbutton%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%5Cn%20%20%20%20%20%20%3C%2Fform%3E%60)%2Cc%3Dt(&#39;%3Cp%20class%3D%22env-text%20env-m-bottom--small%22%20style%3D%22display%3Anone%3B%22%3E%3C%2Fp%3E&#39;)%3Bi.appendChild(h)%2Ci.appendChild(c)%3Bconst%20p%3Dnew%20b(%7B%24index%3A%22No.%22%2Cname%3A%22Name%22%7D%2C%5B%5D%2C%7B%7D)%3Bp.onRowClick(((t%2Ci)%3D%3E%7Bconst%20s%3Dt.name%7C%7Ct.title%3Bd%3Dv(n%2B%22_row%22%2C%7Btitle%3As%2Csize%3A%22large%22%2CcloseText%3A%22Go%20back%22%7D)%2Ce.setDisabled(!0)%3Bconst%20o%3DObject.entries(t).reduce((function(e%2C%5Bt%2Ci%5D)%7Bif(%22%24%22%3D%3D%3Dt%5B0%5D)return%20e%3Bif(Array.isArray(i))for(let%20n%20of%20i)e.push(%5Bt%2Cn%5D)%3Belse%20e.push(%5Bt%2Ci%5D)%3Breturn%20e%7D)%2C%5B%5D)%3Bd.init(%60%3Ctable%20class%3D%22env-table%20env-table--small%20env-table--zebra%20env-w--100%22%3E%3Ccaption%20class%3D%22env-assistive-text%22%3EIndexed%20fields%20for%3A%20%24%7Bs%7D%3C%2Fcaption%3E%3Cthead%3E%3Cth%3EField%3C%2Fth%3E%3Cth%3EValue%3C%2Fth%3E%3C%2Fthead%3E%3Ctbody%3E%24%7Bo.map(((%5Be%2Ct%5D)%3D%3E%60%3Ctr%3E%3Ctd%20style%3D%22max-width%3A28rem%3Boverflow-wrap%3Abreak-word%3Bwhite-space%3Anormal%3B%22%3E%24%7Be%7D%3C%2Ftd%3E%3Ctd%3E%24%7Bt%7D%3C%2Ftd%3E%3C%2Ftr%3E%60)).join(%22%22)%7D%3C%2Ftbody%3E%3C%2Ftable%3E%60)%2Cd.onClosed((t%3D%3E%7Be.setDisabled(!1)%2C(e%3D%3E%7Bconst%20t%3Du()%3Bt%5Be%5D%26%26(t%5Be%5D.remove()%2Cdelete%20t%5Be%5D)%7D)(t.id)%2Cd%3Dnull%7D))%2Cd.toggle()%7D))%2Cp.renderTo(i)%2Ce.context.vTable%3Dp%2Ce.context.searchForm%3Dh%2Cp.el.style.display%3D%22none%22%3Bconst%20m%3Dh.querySelector(&#39;%5Bname%3D%22query%22%5D&#39;)%2Cf%3Dh.querySelector(&#39;%5Bname%3D%22index%22%5D&#39;)%3Blet%20g%3Breturn%20l(h%2C(async%20t%3D%3E%7Bt.preventDefault()%2Cg%26%26(clearTimeout(g)%2Cg%3Dnull)%2Cg%3DsetTimeout((()%3D%3Ee.setLoading(!0))%2C300)%3Bconst%20i%3Dm.value%2Cn%3Df.value%2C%5Bs%2Co%5D%3Dawait%20w(%7BnodeId%3An%2CapiMethod%3A%22search%22%2Coptions%3A%7Bquery%3Ai%2Climit%3A500%2Cfields%3A%5B%22*%22%5D%7D%2CreturnError%3A!0%7D)%2Cl%3D!o%26%26s%3F.length%3E0%3BclearTimeout(g)%2Cg%3Dnull%2Ce.setLoading(!1)%2Ce.renderError(o)%2Cp.el.style.display%3Dl%3F%22%22%3A%22none%22%2Cc.style.display%3D%22%22%2Cc.innerHTML%3Dl%3F%60%24%7Bs.length%7D%24%7B500%3D%3D%3Ds.length%3F%22%20(or%20more)%22%3A%22%22%7D%20hits%20found.%60%3A%22No%20search%20hits%20found.%22%2Cl%26%26!p.rowHeight%26%26p.computeTableDimensions()%2Cp.update(s)%7D))%2Co(m%2C(e%3D%3E%7B%22Escape%22%3D%3D%3De.key%26%26e.target.value%26%26e.stopImmediatePropagation()%7D))%2Ci%7D))%2Cr.onClose((()%3D%3E%7Bd%26%26(d.hide()%2Cd%3Dnull)%7D)).onClosed((e%3D%3E%7Bd%26%26e.setDisabled(!1)%7D)).toggle((e%3D%3E%7Be.context.vTable%3F.computeTableDimensions()%2Ce.context.vTable%3F.renderRows(e.context.vTable.el.scrollTop%2C!0)%7D))%7D)(window%2Cwindow.document)%7D()%3B">
        <svg class="bookmarklet__icon bookmarklet__icon icon" aria-hidden="true"><use href="/assets/img/icons.svg?v=0.12.1#mdi-bookmark"></use></svg>
        <svg class="bookmarklet__icon bookmarklet__icon--error icon" aria-hidden="true"><use href="/assets/img/icons.svg?v=0.12.1#mdi-block-helper"></use></svg>
        <svg class="bookmarklet__icon bookmarklet__icon--success icon" aria-hidden="true"><use href="/assets/img/icons.svg?v=0.12.1#mdi-check-bold"></use></svg>
        <span>Sitevision index</span>
      </a>
    </div>

    <div class="mt-6">
      <h2 class="is-size-4 is-family-secondary">Bookmarklet code</h2><div class="mb-6">
          <h3 class="is-size-5">sitevision-index</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">import</span> createElement <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/create-element'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getCache<span class="token punctuation">,</span> getInstance<span class="token punctuation">,</span> removeInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/Dialog'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> VTable <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/VTable'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> uid <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/uid'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Events <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/Events'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> sitevisionApi <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/sitevision-api'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> toasts <span class="token keyword">from</span> <span class="token string">'../../_lib/shared/toasts'</span><span class="token punctuation">;</span><br><br><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> document</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Bail early if envision is not found.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>envision<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Envision not found. Exiting since most likely not Sitevision.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token constant">SITEVISION_INDEX_DIALOG</span> <span class="token operator">=</span> <span class="token string">'sitevision-index-dialog'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token constant">SITEVISION_INDEX_ROW_DIALOG</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SITEVISION_INDEX_DIALOG</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_row</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> indexes<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token constant">SITEVISION_INDEX_DIALOG</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      indexes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sitevisionApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">nodeId</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>sv<span class="token punctuation">.</span>PageContext<span class="token punctuation">.</span>siteId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_indexRepository</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      toasts<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">SITEVISION_INDEX_DIALOG</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Sitevision index'</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">'large'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> rowDialogInstance <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token constant">SITEVISION_INDEX_ROW_DIALOG</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dialog</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'&lt;div>&lt;/div>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> searchFieldId <span class="token operator">=</span> <span class="token function">uid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> indexFieldId <span class="token operator">=</span> <span class="token function">uid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> searchForm <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;form class="env-form"><br>        &lt;div class="env-form__row"><br>          &lt;div class="env-form-element"><br>            &lt;label for="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>indexFieldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="env-form-element__label">Index&lt;/label><br>            &lt;div class="env-form-element__control"><br>              &lt;select class="env-form-input" id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>indexFieldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" name="index"><br>                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>indexes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;option value="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/option></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>              &lt;/select><br>            &lt;/div><br>          &lt;/div><br><br>          &lt;div class="env-form-element env-form-element--2"><br>            &lt;label for="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchFieldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="env-form-element__label">Search query&lt;/label><br>            &lt;div class="env-form-element__control env-form-input-group"><br>              &lt;input id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchFieldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" type="search" name="query" class="env-form-input env-form-input--search env-flex__item--length-1" placeholder="" /><br>              &lt;button type="submit" class="env-button env-button--primary">Search&lt;/button><br>            &lt;/div><br>          &lt;/div><br>        &lt;/div><br>      &lt;/form></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p class="env-text env-m-bottom--small" style="display:none;">&lt;/p></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string-property property">'$index'</span><span class="token operator">:</span> <span class="token string">'No.'</span><span class="token punctuation">,</span> <span class="token string-property property">'name'</span><span class="token operator">:</span> <span class="token string">'Name'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> resultsTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VTable</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    resultsTable<span class="token punctuation">.</span><span class="token function">onRowClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rowData<span class="token punctuation">,</span> rowIndex</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> rowTitle <span class="token operator">=</span> rowData<span class="token punctuation">.</span>name <span class="token operator">||</span> rowData<span class="token punctuation">.</span>title<span class="token punctuation">;</span><br>      rowDialogInstance <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">SITEVISION_INDEX_DIALOG</span> <span class="token operator">+</span> <span class="token string">'_row'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> rowTitle<span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">'large'</span><span class="token punctuation">,</span> <span class="token literal-property property">closeText</span><span class="token operator">:</span> <span class="token string">'Go back'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      dialog<span class="token punctuation">.</span><span class="token function">setDisabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> rows <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>rowData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> <span class="token punctuation">[</span> key<span class="token punctuation">,</span> value <span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'$'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">return</span> acc<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>          acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> acc<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      rowDialogInstance<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;table class="env-table env-table--small env-table--zebra env-w--100">&lt;caption class="env-assistive-text">Indexed fields for: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rowTitle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/caption>&lt;thead>&lt;th>Field&lt;/th>&lt;th>Value&lt;/th>&lt;/thead>&lt;tbody></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span> field<span class="token punctuation">,</span> value <span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;tr>&lt;td style="max-width:28rem;overflow-wrap:break-word;white-space:normal;"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>field<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/td>&lt;td></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/td>&lt;/tr></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/tbody>&lt;/table></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      rowDialogInstance<span class="token punctuation">.</span><span class="token function">onClosed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rowDialog</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        dialog<span class="token punctuation">.</span><span class="token function">setDisabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">removeInstance</span><span class="token punctuation">(</span>rowDialog<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        rowDialogInstance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      rowDialogInstance<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    resultsTable<span class="token punctuation">.</span><span class="token function">renderTo</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    dialog<span class="token punctuation">.</span>context<span class="token punctuation">.</span>vTable <span class="token operator">=</span> resultsTable<span class="token punctuation">;</span><br>    dialog<span class="token punctuation">.</span>context<span class="token punctuation">.</span>searchForm <span class="token operator">=</span> searchForm<span class="token punctuation">;</span><br><br>    resultsTable<span class="token punctuation">.</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> searchField <span class="token operator">=</span> searchForm<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name="query"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> indexField <span class="token operator">=</span> searchForm<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name="index"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> slowQueryTimerId<span class="token punctuation">;</span><br><br>    Events<span class="token punctuation">.</span><span class="token function">onSubmit</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>slowQueryTimerId<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>slowQueryTimerId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        slowQueryTimerId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      slowQueryTimerId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> dialog<span class="token punctuation">.</span><span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> query <span class="token operator">=</span> searchField<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>      <span class="token keyword">const</span> index <span class="token operator">=</span> indexField<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>      <span class="token keyword">const</span> <span class="token punctuation">[</span> result<span class="token punctuation">,</span> err <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sitevisionApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">nodeId</span><span class="token operator">:</span> index<span class="token punctuation">,</span> <span class="token literal-property property">apiMethod</span><span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> query<span class="token punctuation">,</span> <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'*'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">returnError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> hasResult <span class="token operator">=</span> <span class="token operator">!</span>err <span class="token operator">&amp;&amp;</span> result<span class="token operator">?.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>slowQueryTimerId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      slowQueryTimerId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      dialog<span class="token punctuation">.</span><span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      dialog<span class="token punctuation">.</span><span class="token function">renderError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      resultsTable<span class="token punctuation">.</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> hasResult <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">;</span><br>      info<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>      info<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hasResult <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">500</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> (or more)</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> hits found.</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">'No search hits found.'</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasResult <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>resultsTable<span class="token punctuation">.</span>rowHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        resultsTable<span class="token punctuation">.</span><span class="token function">computeTableDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      resultsTable<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    Events<span class="token punctuation">.</span><span class="token function">onKeydown</span><span class="token punctuation">(</span>searchField<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// Prevent Escape from hiding modal if clearing filter input by escape key.</span><br>      <span class="token comment">// When the filter input is empty, act as normal.</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Escape'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        event<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> container<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  instance<br>    <span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>rowDialogInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        rowDialogInstance<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        rowDialogInstance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">onClosed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dialog</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>rowDialogInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        dialog<span class="token punctuation">.</span><span class="token function">setDisabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dialog</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      dialog<span class="token punctuation">.</span>context<span class="token punctuation">.</span>vTable<span class="token operator">?.</span><span class="token function">computeTableDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      dialog<span class="token punctuation">.</span>context<span class="token punctuation">.</span>vTable<span class="token operator">?.</span><span class="token function">renderRows</span><span class="token punctuation">(</span>dialog<span class="token punctuation">.</span>context<span class="token punctuation">.</span>vTable<span class="token punctuation">.</span>el<span class="token punctuation">.</span>scrollTop<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">.</span>document<span class="token punctuation">)</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">create-element.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DOCUMENT</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">;</span><br><span class="token comment">// const ENVISION = window.envision;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createElement</span> <span class="token punctuation">(</span><span class="token parameter">markup</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token constant">DOCUMENT</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  template<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> markup<span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> template<span class="token punctuation">.</span>content<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">Events.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">CLICK</span> <span class="token operator">=</span> <span class="token string">'click'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">CHANGE</span> <span class="token operator">=</span> <span class="token string">'change'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">INPUT</span> <span class="token operator">=</span> <span class="token string">'input'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">KEYDOWN</span> <span class="token operator">=</span> <span class="token string">'keydown'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">SUBMIT</span> <span class="token operator">=</span> <span class="token string">'submit'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">PASTE</span> <span class="token operator">=</span> <span class="token string">'paste'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> event<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> event<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">CLICK</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">offClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">remove</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">CLICK</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">CHANGE</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">onInput</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">INPUT</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">onKeydown</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">KEYDOWN</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">onSubmit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">SUBMIT</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">onPaste</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">add</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token constant">PASTE</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">Dialog.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Events <span class="token keyword">from</span> <span class="token string">"./Events"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">CLASS_BASE</span> <span class="token operator">=</span> <span class="token string">'env-modal-dialog'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">SPINNER_CLASS</span> <span class="token operator">=</span> <span class="token string">'env-spinner-bounce'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">DOCUMENT</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">ENVISION</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>envision<span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * Creates the HTML markup for an envision dialog.<br> * <br> * @param {object} options An object literal with options.<br> * @param {string} options.dialogId A unique html ID for the dialog.<br> * @param {string} options.title<br> * @returns {string}<br> */</span><br><br><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dialog</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dialogId<span class="token punctuation">,</span> title<span class="token punctuation">,</span> size<span class="token punctuation">,</span> closeText <span class="token operator">=</span> <span class="token string">'Close'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> dialogId<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>isDisabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>closeText <span class="token operator">=</span> closeText<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <br>    <span class="token keyword">this</span><span class="token punctuation">.</span>tid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-t'</span><span class="token punctuation">;</span> <span class="token comment">// title</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>thid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-th'</span><span class="token punctuation">;</span> <span class="token comment">// title holder</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>cid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-c'</span><span class="token punctuation">;</span> <span class="token comment">// content</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>eid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-e'</span><span class="token punctuation">;</span> <span class="token comment">// error</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>fid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-f'</span><span class="token punctuation">;</span> <span class="token comment">// footer</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>lid <span class="token operator">=</span> dialogId <span class="token operator">+</span> <span class="token string">'-l'</span><span class="token punctuation">;</span> <span class="token comment">// loader</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * Shortcut for Document.getElementById() for improved minification.<br>   * <br>   * @param {string} id An identifier for an HTMLElement.<br>   * @returns {(HTMLElement|null)}<br>   */</span><br>  <span class="token function">el</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token constant">DOCUMENT</span><span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <br><br>  <span class="token comment">/**<br>   * Initializes the dialog if it hasn't already been initialized.<br>   * <br>   * @param {(Function|String|HTMLElement)} initialContent <br>   * @returns {Dialog} Returns self for chainability.<br>   */</span><br>  <span class="token keyword">async</span> <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">initialContent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> dialogId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> titleId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tid<span class="token punctuation">;</span><br>  <br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span>dialogId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> initialContentError<span class="token punctuation">;</span><br><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      initialContent <span class="token operator">=</span> <span class="token keyword">typeof</span> initialContent <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">initialContent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> initialContent<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      initialContentError <span class="token operator">=</span> e<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">const</span> contentString <span class="token operator">=</span> <span class="token keyword">typeof</span> initialContent <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> initialContent <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> sizeClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__dialog--</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <br>    <span class="token comment">// Insert dialog into end of body and show dialog with envision.</span><br>    <span class="token constant">DOCUMENT</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><br>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dialogId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--inner-scroll" style="z-index:99999" role="dialog" aria-modal="true" aria-labelledby="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>titleId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" aria-hidden="true" tabindex="-1"><br>      &lt;div class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__dialog </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sizeClass<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"><br>        &lt;section class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__content"><br>          &lt;header class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__header"><br>            &lt;h5 id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>titleId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="env-text env-d--flex env-flex--align-items-center env-flex--justify-content-between </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__header__title"><br>              &lt;span id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>thid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span><br>              &lt;div id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SPINNER_CLASS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SPINNER_CLASS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--hide </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SPINNER_CLASS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--fade-in" data-delay="medium"><br>                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="env-bounce</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>              &lt;/div><br>            &lt;/h5><br>          &lt;/header><br>          &lt;div class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__body"><br>            &lt;div id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div><br>            &lt;div id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>eid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="env-alert env-alert--danger" hidden><br>              &lt;span data-error-holder>&lt;/span><br>              &lt;button type="button" class="env-alert__close env-button env-button--link env-button--icon env-button--icon-small" data-dismiss="alert"><br>                Close<br>                &lt;svg class="env-icon env-icon--xx-small"><br>                  &lt;use href="/sitevision/envision-icons.svg#icon-delete">&lt;/use><br>                &lt;/svg><br>              &lt;/button><br>            &lt;/div><br>          &lt;/div><br>          &lt;footer id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>fid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CLASS_BASE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">__footer env-d--flex env-flex--justify-content-between"><br>            &lt;button type="button" data-modal-dialog-dismiss class="env-button env-m-left--a"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>closeText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/button><br>          &lt;/footer><br>        &lt;/section><br>      &lt;/div><br>    &lt;/div></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialContentError<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderError</span><span class="token punctuation">(</span>initialContentError<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    Events<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-dismiss="alert"]'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderError</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialContent <span class="token keyword">instanceof</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>initialContent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">isOpen</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">?.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'env-modal-dialog--show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * @param {string} title <br>   */</span><br>  <span class="token function">updateTitle</span> <span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thid<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> title<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * @param {string} html <br>   */</span><br>  <span class="token function">updateContent</span> <span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * @param {boolean} isLoading <br>   */</span><br>  <span class="token function">setLoading</span> <span class="token punctuation">(</span><span class="token parameter">isLoading</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>isLoading<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lid<span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SPINNER_CLASS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--hide</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">setDisabled</span> <span class="token punctuation">(</span><span class="token parameter">isDisabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>isDisabled <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>isDisabled<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>inert <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDisabled<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDisabled <span class="token operator">?</span> <span class="token number">0.5</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.env-button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">btn</span><span class="token punctuation">)</span> <span class="token operator">=></span> btn<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDisabled<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <br>  <span class="token comment">/**<br>   * @param {string} errorMessage <br>   */</span><br>  <span class="token function">renderError</span> <span class="token punctuation">(</span><span class="token parameter">errorMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> hasError <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>errorMessage<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> errorElement <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eid<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    errorElement<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-error-holder]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> errorMessage<span class="token punctuation">;</span><br>    errorElement<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token operator">!</span>hasError<span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">.</span>hidden <span class="token operator">=</span> hasError<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">onClose</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// TODO: should probably start using new Dialog api instead of old ModalDialog so we can </span><br>      <span class="token comment">// remove jQuery as a dependency.</span><br>      <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'hide.env-modal-dialog'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">onClosed</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// TODO: should probably start using new Dialog api instead of old ModalDialog so we can </span><br>      <span class="token comment">// remove jQuery as a dependency.</span><br>      <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'hidden.env-modal-dialog'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">hide</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">ENVISION</span><span class="token punctuation">.</span><span class="token function">dialog</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'hide'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>callback <span class="token operator">?</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * @param {Function} callback Callback run when Envision.dialog promise has finished.<br>   * @returns {Dialog}<br>   */</span><br>  <span class="token function">toggle</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">ENVISION</span><span class="token punctuation">.</span><span class="token function">dialog</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'toggle'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>callback <span class="token operator">?</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <br>  <span class="token punctuation">}</span><br><br>  <span class="token function">remove</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">el</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> Dialog<span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * @returns {Record&lt;string,Dialog>}<br> */</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getCache</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> instances <span class="token operator">=</span> window<span class="token punctuation">.</span>__BookmarkletDialogInstances <span class="token operator">=</span> window<span class="token punctuation">.</span>__BookmarkletDialogInstances <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> instances<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> instances<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * @returns {Dialog}<br> */</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dialogId<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> instances <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>opts<span class="token punctuation">,</span> dialogId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">removeInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dialogId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> instances <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">delete</span> instances<span class="token punctuation">[</span>dialogId<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">ensure-styles.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DOCUMENT</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ensureStyles</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> css</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <br>  <span class="token comment">// https://www.npmjs.com/package/clean-css#minify-method</span><br>  <span class="token comment">// https://github.com/TrySound/rollup-plugin-string/blob/master/index.js</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>link<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">DOCUMENT</span><span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;style id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>css<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/style></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> link<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">VTable.css</h3>
          <pre class="language-css"><code class="language-css"><span class="token selector">.__VTable-container</span> <span class="token punctuation">{</span><br>  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container table</span> <span class="token punctuation">{</span><br>  <span class="token property">table-layout</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container thead</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> sticky<span class="token punctuation">;</span><br>  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token property">z-index</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container thead tr</span> <span class="token punctuation">{</span><br>  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--env-section-background-color<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container thead th,<br>.__VTable-container tbody td</span> <span class="token punctuation">{</span><br>  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span><br>  <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><br>  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span><br>  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span><br>  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container thead th:first-child,<br>.__VTable-container tbody td:first-child</span> <span class="token punctuation">{</span><br>  <span class="token property">flex</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 6em<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container tbody</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container tbody tr</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.__VTable-container .env-table--hover tr:hover</span> <span class="token punctuation">{</span><br>  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">VTable.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">import</span> createElement <span class="token keyword">from</span> <span class="token string">"./create-element"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> ensureStyles <span class="token keyword">from</span> <span class="token string">"./ensure-styles"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> css <span class="token keyword">from</span> <span class="token string">"./VTable.css"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">VTABLE_STYLES_ID</span> <span class="token operator">=</span> <span class="token string">'__VTable-styles'</span><br><span class="token keyword">const</span> <span class="token constant">VTABLE_BASE_CLASS</span> <span class="token operator">=</span> <span class="token string">'__VTable-container'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">DEFAULT_OPTS</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">caption</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VTable</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">headers<span class="token punctuation">,</span> data<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>headers <span class="token operator">=</span> headers<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>dataFormat <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight <span class="token operator">=</span> <span class="token number">27.5</span><span class="token punctuation">;</span> <span class="token comment">// Default height. Is updated on init.</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>opts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token constant">DEFAULT_OPTS</span><span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <br>  <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> headers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opts<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> caption <span class="token operator">=</span> opts<span class="token punctuation">.</span>caption<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> height <span class="token operator">=</span> opts<span class="token punctuation">.</span>height<span class="token punctuation">;</span><br><br>    <span class="token function">ensureStyles</span><span class="token punctuation">(</span><span class="token constant">VTABLE_STYLES_ID</span><span class="token punctuation">,</span> css<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>cols <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">VTABLE_BASE_CLASS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" style="height:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;"><br>        &lt;table class="env-table env-table--small env-table--hover env-w--100"><br>          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">!</span><span class="token operator">!</span>caption <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;caption class="env-assistive-text"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>caption<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/caption></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>          &lt;thead class="env-d--block env-w--100">&lt;tr class="env-d--flex"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>headers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;th></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>h<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/th></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/tr>&lt;/thead><br>          &lt;tbody class="env-d--block" style="height:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;">&lt;/tbody><br>        &lt;/table><br>      &lt;/div></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">setData</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dataRow<span class="token punctuation">,</span> rowIndex</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      dataRow<span class="token punctuation">.</span>$index <span class="token operator">=</span> rowIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> dataRow<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>numRows <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">getRowData</span> <span class="token punctuation">(</span><span class="token parameter">rowIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>rowIndex<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">renderRows</span> <span class="token punctuation">(</span><span class="token parameter">scrollTop<span class="token punctuation">,</span> force <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> newStart <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>force <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">!==</span> newStart<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> newStart<span class="token punctuation">;</span><br><br>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> rowIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">+</span> i<span class="token punctuation">;</span><br><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rowIndex <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numRows<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">const</span> row <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>          <span class="token keyword">const</span> rowCells <span class="token operator">=</span> row<span class="token punctuation">.</span>children<span class="token punctuation">;</span><br>          <br>          <span class="token comment">// Update columns with data for the row</span><br>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span> columnIndex<span class="token punctuation">,</span> columnKey <span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cols<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            rowCells<span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>rowIndex<span class="token punctuation">]</span><span class="token punctuation">[</span>columnKey<span class="token punctuation">]</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <br>          row<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>rowIndex <span class="token operator">=</span> rowIndex<span class="token punctuation">;</span><br>          row<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rowIndex <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>          row<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// TODO: Do I really need to hide/show these anymore? Should always only be 2 extra.</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>          <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span> <span class="token comment">// TODO: Same here. Needed?</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">computeRowHeight</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> tr <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;tr>&lt;td>&amp;nbsp;&lt;/td>&lt;/tr></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight <span class="token operator">=</span> tr<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span> <span class="token comment">// offsetHeight;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">computeVisibleRows</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> visibleRows <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Number of visible rows, plus buffer</span><br><br>    <span class="token keyword">return</span> visibleRows<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">resetPool</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> visibleRows <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computeVisibleRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> visibleRows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> tr <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;tr></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'&lt;td>&lt;/td>'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cols<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/tr></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">computeTableDimensions</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computeRowHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computeVisibleRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>numRows <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">renderTo</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    target<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderRows</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderRows</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">onRowClick</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> eventTarget <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span><br>        <span class="token keyword">const</span> rowIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>eventTarget<span class="token operator">?.</span>tagName <span class="token operator">===</span> <span class="token string">'TR'</span> <span class="token operator">?</span> eventTarget <span class="token operator">:</span> eventTarget<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?.</span>dataset<span class="token punctuation">.</span>rowIndex<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">const</span> rowData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRowData</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>          <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> rowData<span class="token punctuation">,</span> rowIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>bodyEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>numRows <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rowHeight<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Reset scroll when updating data</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderRows</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">uid.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">uid</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token string">'-'</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">sitevision-api.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">OFFLINE</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ONLINE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * Performs a fetch request to the Sitevision Rest API.<br> * <br> * @param {object} options An object literal with options.<br> * @param {string} options.nodeId The node identifier to perform the api request on.<br> * @param {string} options.path The path to perform the api request on.<br> * @param {string} options.siteName The site's name. Required when using path.<br> * @param {number} [options.version=ONLINE] The version to use.<br> * @param {string} [options.apiMethod='nodes'] The API method to call. (Usually one of: 'nodes', 'properties', 'contentNodes', 'headless')<br> * @param {object} [options.options={}] Options to be passed to the API method.<br> * @param {string} [options.origin=window.location.origin] The origin to send the request to.<br> * @returns {Response}<br> */</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sitevisionApi</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> nodeId<span class="token punctuation">,</span> path<span class="token punctuation">,</span> siteName<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token constant">ONLINE</span><span class="token punctuation">,</span> apiMethod <span class="token operator">=</span> <span class="token string">'nodes'</span><span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> origin <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token punctuation">,</span> returnError <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodeId <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>path <span class="token operator">&amp;&amp;</span> siteName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">throw</span> <span class="token string">'Api needs either a nodeId or a path.'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <br>  <span class="token keyword">const</span> apiParams <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> fetchOpts <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span><br>      <span class="token string-property property">'Accept'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">OFFLINE</span><span class="token punctuation">,</span> <span class="token constant">ONLINE</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token operator">?</span> version <span class="token operator">:</span> <span class="token constant">ONLINE</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/rest-api/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nodeId <span class="token operator">||</span> <span class="token punctuation">(</span>siteName <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/|\/$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiMethod<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?format=json&amp;json=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiParams<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">===</span> <span class="token constant">OFFLINE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    fetchOpts<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token string">'same-origin'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">let</span> response<span class="token punctuation">;</span><br>  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fetchOpts<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    response <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ok</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    e <span class="token operator">=</span> <span class="token punctuation">[</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Status </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>      data<span class="token operator">?.</span>description<span class="token punctuation">,</span><br>      data<span class="token operator">?.</span>message<span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>returnError<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">throw</span> e<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>returnError<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span> data<span class="token punctuation">,</span> e <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> data<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
        </div><div class="mb-6">
          <h3 class="is-size-5">toasts.js</h3>
          <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DOCUMENT</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * @typedef {Object} ToastOptions<br> * @property {"success" | "primary" | ""} [type=""] The type of toast to emit.<br> * @property {number} [ttl=4] (time to live) in seconds for toast to be shown.<br> * @property {Function} [callback] A callback function executed when toast is removed.<br> * @property {Boolean} [checkmark=undefined] Boolean value if checkmark should be shown.<br> * @property {string} [heading=""] A header string, (not required), will be &lt;strong>.<br> * @property {string} message A message string.<br> */</span><br><br><span class="token comment">/**<br> * @param {ToastOptions} options <br> */</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">publish</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">publish</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token constant">DOCUMENT</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'sv-publish-toast'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">detail</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      <span class="token operator">...</span>options<span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> publish <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
        </div></div>
  </div>
</div>

      </main><!--! .page-main -->

      <footer class="page-footer section has-background-secondary-dark has-text-white py-5">
        <div class="container">
          <p class="has-text-centered">
            <a class="page-footer__link has-text-white" href="https://github.com/hampusn/bookmarklets#readme">
              <strong>bookmarklets</strong>
              <svg class="icon" aria-label="External link"><use href="/assets/img/icons.svg?v=0.12.1#mdi-open-in-new"></use></svg>
            </a>
            is created by
            <a class="page-footer__link has-text-white" href="https://hampus.io/">
              <strong>Hampus Nordin</strong>
              <svg class="icon" aria-label="External link"><use href="/assets/img/icons.svg?v=0.12.1#mdi-open-in-new"></use></svg>
            </a>
          </p>
        </div>
      </footer><!--! .page-footer -->
    </div><!--! .page -->

    <div id="bookmarklet-drag" class="bookmarklet-drag"></div>
    <script type="module" src="/assets/js/main.js?v=0.12.1"></script>
    <!-- Current page: /sitevision-index/ -->
  </body>
</html>
